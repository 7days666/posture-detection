# 需求文档

## 简介

本文档定义了儿童青少年体态检测平台的"积分奖励制度"功能需求。该功能旨在通过积分激励机制，鼓励用户持续参与体态检测，并提供积分商店供用户兑换奖品，同时为管理员提供完整的后台管理能力。

## 术语表

- **积分系统（Points_System）**：负责计算、累计、重置用户积分的核心模块
- **检测月份（Detection_Month）**：用户完成体态检测的自然月份
- **连续检测月数（Consecutive_Months）**：用户不间断参与检测的累计月份数
- **补测（Makeup_Detection）**：当月未按时完成检测时，在次月5日前申请的补充检测
- **积分商店（Points_Store）**：用户使用积分兑换奖品的功能模块
- **兑换订单（Redemption_Order）**：用户使用积分兑换商品后生成的订单记录
- **商品（Product）**：积分商店中可供兑换的奖品

## 需求

### 需求 1：月度积分计算

**用户故事：** 作为用户，我希望每月完成体态检测后获得积分奖励，以便激励我持续参与检测。

#### 验收标准

1. WHEN 用户在某自然月内首次完成体态检测 THEN 积分系统 SHALL 根据该用户的连续检测月数计算积分（第n个月奖励10×n分）
2. WHEN 用户在同一自然月内重复进行体态检测 THEN 积分系统 SHALL 不再累计额外积分
3. WHEN 用户完成检测获得积分 THEN 积分系统 SHALL 立即更新用户的总积分余额
4. THE 积分系统 SHALL 记录每次积分变动的详细信息，包括变动类型、变动数量、变动时间和关联的检测记录

### 需求 2：连续检测月数追踪

**用户故事：** 作为用户，我希望系统能追踪我的连续检测月数，以便我了解自己的参与情况和积分增长趋势。

#### 验收标准

1. WHEN 用户在新的自然月首次完成检测 THEN 积分系统 SHALL 将该用户的连续检测月数加1
2. WHEN 用户在某自然月未完成任何检测且未在次月5日前完成补测 THEN 积分系统 SHALL 将该用户的连续检测月数重置为0
3. THE 积分系统 SHALL 在用户个人中心展示当前连续检测月数
4. THE 积分系统 SHALL 在用户个人中心展示下次检测可获得的预期积分

### 需求 3：补测申请与审核

**用户故事：** 作为用户，我希望在错过当月检测时能够申请补测，以便保持我的连续检测记录。

#### 验收标准

1. WHEN 用户在次月1日至5日期间申请补测 THEN 积分系统 SHALL 允许用户提交补测申请
2. WHEN 用户的补测申请通过审核 THEN 积分系统 SHALL 仅授予当月基础积分（10分），不影响连续月数计算
3. WHEN 用户在同一补测周期内已有一次补测记录 THEN 积分系统 SHALL 拒绝新的补测申请
4. IF 补测申请超过次月5日 THEN 积分系统 SHALL 拒绝该补测申请并提示用户已超时
5. THE 积分系统 SHALL 记录所有补测申请的状态（待审核、已通过、已拒绝）

### 需求 4：积分兑换门槛

**用户故事：** 作为用户，我希望在达到一定连续检测月数后能够兑换奖品，以便获得实际的奖励回报。

#### 验收标准

1. WHEN 用户的连续检测月数少于3个月 THEN 积分商店 SHALL 禁止该用户进行任何兑换操作
2. WHEN 用户的连续检测月数达到或超过3个月 THEN 积分商店 SHALL 允许该用户兑换对应档位的商品
3. THE 积分商店 SHALL 在商品详情页展示兑换所需的最低连续检测月数要求
4. WHEN 用户尝试兑换商品时积分不足 THEN 积分商店 SHALL 拒绝兑换并提示积分不足

### 需求 5：积分商店商品展示

**用户故事：** 作为用户，我希望浏览积分商店中的可兑换商品，以便选择我想要的奖品。

#### 验收标准

1. THE 积分商店 SHALL 展示所有已上架商品的名称、图片、所需积分和库存状态
2. WHEN 商品库存为0 THEN 积分商店 SHALL 将该商品标记为"已售罄"并禁止兑换
3. THE 积分商店 SHALL 支持按商品分类筛选展示
4. THE 积分商店 SHALL 按所需积分从低到高排序展示商品

### 需求 6：积分兑换流程

**用户故事：** 作为用户，我希望使用积分兑换商品，以便获得实际奖励。

#### 验收标准

1. WHEN 用户确认兑换商品 THEN 积分系统 SHALL 扣除相应积分并生成兑换订单
2. WHEN 兑换成功 THEN 积分系统 SHALL 减少商品库存数量
3. THE 积分系统 SHALL 记录兑换订单的详细信息，包括商品信息、扣除积分、兑换时间和订单状态
4. WHEN 用户查看兑换记录 THEN 积分商店 SHALL 展示该用户的所有历史兑换订单

### 需求 7：后台商品管理

**用户故事：** 作为管理员，我希望管理积分商店的商品，以便维护商品目录和库存。

#### 验收标准

1. WHEN 管理员添加新商品 THEN 管理后台 SHALL 创建商品记录并设置初始库存
2. WHEN 管理员编辑商品信息 THEN 管理后台 SHALL 更新商品的名称、描述、图片、所需积分或库存
3. WHEN 管理员下架商品 THEN 管理后台 SHALL 将商品状态设为不可见，已生成的订单不受影响
4. THE 管理后台 SHALL 展示所有商品的列表，包括上架状态和当前库存

### 需求 8：后台订单管理

**用户故事：** 作为管理员，我希望管理用户的兑换订单，以便处理发货和售后。

#### 验收标准

1. THE 管理后台 SHALL 展示所有兑换订单的列表，支持按状态筛选
2. WHEN 管理员更新订单状态 THEN 管理后台 SHALL 记录状态变更并更新订单信息
3. THE 管理后台 SHALL 支持查看订单详情，包括用户信息、商品信息和兑换时间
4. THE 管理后台 SHALL 支持按用户、商品、时间范围搜索订单

### 需求 9：后台用户积分管理

**用户故事：** 作为管理员，我希望查看和调整用户积分，以便处理特殊情况和客服需求。

#### 验收标准

1. THE 管理后台 SHALL 展示用户的积分余额、连续检测月数和积分变动历史
2. WHEN 管理员手动调整用户积分 THEN 管理后台 SHALL 记录调整原因和操作人
3. THE 管理后台 SHALL 支持按用户搜索积分信息
4. IF 管理员尝试将用户积分调整为负数 THEN 管理后台 SHALL 拒绝该操作

### 需求 10：积分数据持久化

**用户故事：** 作为系统，我需要可靠地存储和检索积分相关数据，以便保证数据一致性。

#### 验收标准

1. THE 积分系统 SHALL 将用户积分余额、连续检测月数存储在数据库中
2. THE 积分系统 SHALL 将所有积分变动记录存储在数据库中，支持审计追溯
3. THE 积分系统 SHALL 将商品信息和兑换订单存储在数据库中
4. FOR ALL 积分变动操作，序列化后再反序列化 SHALL 产生等价的数据对象（数据持久化往返一致性）
